<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">

<!-- Begin Jekyll SEO tag v2.2.3 -->
<title>hoopoe-profiler | Open Source and forever free Java Profiler</title>
<meta property="og:title" content="hoopoe-profiler" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Open Source and forever free Java Profiler" />
<meta property="og:description" content="Open Source and forever free Java Profiler" />
<link rel="canonical" href="https://orange-buffalo.github.io/hoopoe-profiler/dev-guide/integration-testing/" />
<meta property="og:url" content="https://orange-buffalo.github.io/hoopoe-profiler/dev-guide/integration-testing/" />
<meta property="og:site_name" content="hoopoe-profiler" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"WebPage","headline":"hoopoe-profiler","description":"Open Source and forever free Java Profiler","url":"https://orange-buffalo.github.io/hoopoe-profiler/dev-guide/integration-testing/"}</script>
<!-- End Jekyll SEO tag -->

    <meta name="description" content="Open Source and forever free Java Profiler
"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/hoopoe-profiler/assets/css/style.css?v=">
  </head>
  <body>
    <section class="main-content">
      <div class="sect1">
<h2 id="integration-testing">Integration Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We have developed a small framework around <a href="https://www.testcontainers.org/">Test Containers</a> which:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>allows to use any number of <a href="https://www.testcontainers.org/usage/generic_containers.html">Generic Containers</a>
(we do not support docker files and docker compose for now);</p>
</li>
<li>
<p>provides API to deploy your plugin / extension into application running in Docker container;</p>
</li>
<li>
<p>provides API to interact with a container while profiler is active and to retrieve profiled result.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="basics">Basics</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    private static GenericContainer javaAppContainer = new GenericContainer("...");   <b class="conum">(1)</b>

    private static GenericContainer dbContainer = new GenericContainer("...");        <b class="conum">(1)</b>

    @ClassRule <b class="conum">(2)</b>
    public static HoopoeIntegrationTest integrationTest = new HoopoeIntegrationTest()
            .withHoopoeContainer(javaAppContainer)      <b class="conum">(3)</b>
            .withContainer(dbContainer)                 <b class="conum">(4)</b>
            .withPlugin(URL_TO_ASSEMBLED_PLUGIN);       <b class="conum">(5)</b>

    @Test
    public void verifyMe() {
        HoopoeProfiledResult profiledResult = integrationTest.executeProfiled(() -&gt; {   <b class="conum">(6)</b>
            ...
        });

        assertThat("Framework should return not-null result any time",
                profiledResult, notNullValue());     <b class="conum">(7)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Define any number of Test Containers (make sure they are not annotated with <code>ClassRule/Rule</code>).</p>
</li>
<li>
<p>Create a class rule / method rule of type <code>HoopoeIntegrationTest</code>.</p>
</li>
<li>
<p>Provide container where profiler should be enabled to <code>withHoopoeContainer</code> method.
See below for more information.</p>
</li>
<li>
<p>Register all other containers.</p>
</li>
<li>
<p>Add your plugin / extension to be deployed with profile.</p>
</li>
<li>
<p>Execute any code you want to profile within your app in container, wrapped into <code>executeProfiled</code> call
(for instance, call an HTTP endpoint in your app which triggers code to be profiled).</p>
</li>
<li>
<p><code>HoopoeProfiledResult</code> will be returned with whatever was recorded during execution of code in <code>executeProfiled</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="container-with-profiler">Container with profiler</h3>
<div class="paragraph">
<p>Container provided for <code>withHoopoeContainer</code> method will be enriched with Hoopoe Profiler agent:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>HoopoeIntegrationTest</code> rule will create agent jar and make it available inside container.</p>
</li>
<li>
<p>New environment variable with the path to agent jar will be added to the container: <code>HOOPOE_AGENT</code>.</p>
</li>
<li>
<p>It is a responsibility of a developer to enable agent for his app in container (i.e. add
<code>-javaagent:$HOOPOE_AGENT</code> to the arguments of <code>java</code> process).</p>
</li>
</ul>
</div>
</div>
</div>
</div>

      <footer class="site-footer">
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </section>

    
  </body>
</html>